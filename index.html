<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Math Parser and Renderer</title>
    <link rel="stylesheet" href="css/normalize.min.css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Inconsolata" />
    <link rel="stylesheet" href="css/style.min.css" />

    <!-- Attempt to load MathJax from CDN; fall back to local if offline -->
    <script src="//d3eoax9i5htok0.cloudfront.net/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script>window.MathJax || document.write('<script src="js/libs/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"><\/script>');</script>
</head>
<body>
    <header>
        <h1>Math Parser and Renderer</h1>
    </header>
    <div role="main">
        <input type="text" name="math" id="math_input" />
        <div id="math_output">\[\mathrm{\LaTeX\ Output}\]</div>
        <div id="tex_output"><code>Raw LaTeX Output</code></div>
        <div id="ast_output"><code>Parse Tree</code></div>

        <h2>Instructions</h2>
        <p>
            Enter a mathematical expression and watch the rendering and parse tree evolve as you type.
            Please note that no LaTeX/AST output will be rendered until a successful parse.
        </p>

        <h2>Sample Inputs</h2>
        <p>
            Click on an expression below to use it as the mathematical input above.
        <ul>
            <li>Slope-Intercept form: <code class="math"><a href="#math_input">y = m*x + b</a></code></li>
            <li>Quadratic form: <code class="math"><a href="#math_input">a*x^2 + b*x + c = 0</a></code></li>
            <li>Quadratic equation:
                <ul>
                    <li>Traditional: <code class="math"><a href="#math_input">x = (-b &amp;pm sqrt(b^2 - 4*a*c))/(2*a)</a></code></li>
                    <li>Set form: <code class="math"><a href="#math_input">x = {(-b+sqrt(b^2-4*a*c))/(2*a), (-b-sqrt(b^2-4*a*c))/(2*a)}</a></code></li>
                </ul>
            </li>
            <li>Integration: <code class="math"><a href="#math_input">int(1/(1+x^2), x, 0, 1) = #p/4</a></code></li>
            <li>Differentiation: <code class="math"><a href="#math_input">diff(arcsin(x), x) = 1/sqrt(1-x^2)</a></code></li>
            <li>Limits: <code class="math"><a href="#math_input">f'(x) = lim((f(x+h)-f(x))/h, h, 0)</a></code></li>
            <li>Volume of Parallelepiped: <code class="math"><a href="#math_input">V = &lt;u_x, u_y, u_z&gt; &amp;. &lt;v_x, v_y, v_z&gt; &amp;x &lt;w_x, w_y, w_z&gt;</a></code></li>
            <li>Logical connectives: <code class="math"><a href="#math_input">p and (q or r) = p &amp;&amp; q || p &amp;&amp; r</a></code></li>
            <li>Definition of the <em>subset</em> relation: <code class="math"><a href="#math_input">A subset B &lt;-&gt; a in A implies a in B</a></code></li>
            <li>Definition of Big-Oh: <code class="math"><a href="#math_input">f(x) in O(g(x)) iff exists x_0 in #Z, exists C in #R, forall x&gt;x_0, (|f(x)|&lt;=C*|g(x)|)</a></code></li>
        </ul>
    </div>
    <footer>
        <p>
            Copyright &copy;2012 Matthew Barry.
            All rights reserved.
        </p>
        <p>
            Version 1.0 &beta;1
        </p>
    </footer>

    <script src="build/browser/parser.js"></script>

    <!-- Attempt to load jQuery from Google CDN; fall back to local if offline -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/libs/jquery-1.7.1.min.js"><\/script>');</script>

    <script>
        $(document).ready(function() {
            var mathInput  = $('#math_input'),
                mathOutput = $('#math_output'),
                astOutput  = $('#ast_output'),
                rawOutput  = $('#tex_output'),
                mjQueue    = MathJax.Hub.queue,
                mjOutBox;

            // make ouput box variable available to dynamic content setter
            mjQueue.Push(function() {
                mjOutBox = MathJax.Hub.getAllJax('math_output')[0];
            });
            
            function updateMath(math) {
                var ast, result;
                mathOutput.css({'color': '#000'});

                try {
                    if (math.length > 0) {
                        // attempt to parse mathematical input and display rendered LaTeX
                        ast = MathParser.parse(math);
                        latex = MathParser.render(ast, 'latex');
                        mjQueue.Push(['Text', mjOutBox, "\\displaystyle{" + latex + "}"]);
                        rawOutput.html('<pre>' + latex + '<\/pre>')
                        astOutput.html('<pre>' + MathParser.render(ast, 'text-tree') + '<\/pre>');
                    } else {    
                        mjQueue.Push(['Text', mjOutBox, "\\displaystyle{\\mathrm{\\LaTeX\\ Output}}"]);
                        astOutput.html('<code>Parse Tree<\/code');
                    }
                } catch (e) {
                    // if we encounter a parse error, change color of output box
                    mathOutput.css({'color': '#f00'});
                    console.log(e.message);
                }
            }

            $('code.math a').click(function(e) {
                var math = $(this).text();
                mathInput.val(math);
                updateMath(math);
            });

            // keyup event binding to input text box
            mathInput
                .keyup(function(e) {
                    updateMath($(this).val());
                })
                .val('')
                .focus()
            ;
        });
    </script>
</body>

</html>